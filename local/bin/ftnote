#!/usr/bin/env bash
#
# Search for '@tag' in markdown files
#     - Requirements: ripgrep fzf nvim


declare file line notes_dir
declare -a rg_opts

notes_dir="$XDG_DATA_HOME"/notes
rg_opts=( --color=always --no-heading --line-number --smart-case --only-matching )

read -r file line <<<"$(rg "${rg_opts[@]}" -- '\B@\S+' "${notes_dir}"  2>/dev/null \
    | fzf -0 -1 --query="$1" \
    | awk -F: '{print $1, $2}')"

[[ -n "${file}" ]] && "${EDITOR:-nvim}" "${file}" +"${line}"

unset -v file line
unset rg_opts

