#!/usr/bin/env bash
#
# Search for '@tag' in markdown files
# Usage: ftnote
#     - Requirements: ripgrep fzf nvim


ftnote() {
  local file line notes_dir
  local -a rg_opts

  notes_dir="${XDG_DATA_HOME:-$HOME/.local/share}"/notes
  rg_opts=( --color=always --no-heading --line-number --smart-case --only-matching )

  read -r file line <<<"$(rg "${rg_opts[@]}" -- '\B@\S+' "${notes_dir}"  2>/dev/null \
    | fzf -0 -1 --query="$1" \
    | awk -F: '{print $1, $2}')"

  [[ -n "${file}" ]] && "${EDITOR:-nvim}" "${file}" +"${line}"
}

ftnote "$@"

