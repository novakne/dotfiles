#!/usr/bin/env bash
#
# Open an exit menu with confirmation in rofi
#
# USAGE: rofi-power-menu
#
# REQUIREMENTS: rofi
# OPTIONALS:

_confirm()
{
	local -a rofi_opts

	rofi_opts=(
		-dmenu
		-i
		-format d
		-lines 2
		-selected-row 0
		-p "${1:-_confirm: }"
		-theme themes/menu.rasi
	)
	printf -- '%s\n%s\n' "Yes" "No" | rofi "${rofi_opts[@]}"
}

main()
{
	local quit shutdown reboot suspend hibernate
	local -a rofi_opts

	quit=" Quit awesome"
	shutdown=" Shutdown"
	reboot=" Reboot"
	suspend=" Suspend"
	hibernate=" Hibernate"

	rofi_opts=(
		-dmenu
		-i
		-lines 5
		-p 'Exit: '
		-theme themes/menu.rasi
	)

	options="${quit}\n${shutdown}\n${reboot}\n${suspend}\n${hibernate}"
	selection=$(echo -e "${options}" | rofi "${rofi_opts[@]}")

	case ${selection} in
		"$quit") awesome quit ;;
		"$shutdown") [[ $(_confirm "$@") = 1 ]] && (systemctl poweroff) ;;
		"$reboot") [[ $(_confirm "$@") = 1 ]] && (systemctl reboot) ;;
		"$suspend") [[ $(_confirm "$@") = 1 ]] && (systemctl suspend) ;;
		"$hibernate") [[ $(_confirm "$@") = 1 ]] && (systemctl hibernate) ;;
	esac

	unset -f _confirm
}

main "$@"
