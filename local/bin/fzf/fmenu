#!/usr/bin/env bash
#
# Fuzzy find bin and launch it
#
# USAGE: fmenu [-l|local]
#
# REQUIREMENTS: fzf
# OPTIONALS: fd

shopt -s lastpipe

fmenu()
{
	local -a paths

	case "$1" in
		-l | local)
			paths=(
				"$HOME"/.local/bin
				"$HOME"/.local/bin/app
			)
			;;
		*)
			paths=(
				"$HOME"/.local/bin
				"$HOME"/.local/bin/app
				/usr/bin
			)
			;;
	esac

	for p in "${paths[@]}"; do
		if hash fd >/dev/null 2>&1; then
			fd . "$p" -texecutable -tsymlink --no-ignore --exec printf '%s\n' "{/}"
		else
			ls "$p"
		fi
	done | sort -u | fzf -0 -1 -e -i --prompt='launch => ' | read -r cmd

	[[ -n "${cmd}" ]] || exit

	setsid /usr/bin/env bash -c "${cmd}" >/dev/null 2>&1 &
	sleep 0.1
}

fmenu "$@"
