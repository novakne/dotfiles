#!/usr/bin/env bash
#
# Open the selected file with neovim
# `ctrl-o` to open in a neovim instance if it exists
# Bypass fuzzy finder if there's only one match (--select-1)
# Exit if there's no match (--exit-0)
#
# USAGE: fe
#
# REQUIREMENTS: fzf - neovim-remote

fe()
{
	local key file
	local -a fzf_opts out

	fzf_opts=(
		--query="$1"
		--multi
		--select-1
		--exit-0
		--header='Open in $EDITOR - [ctrl-o: open with nvr]'
		--expect='ctrl-o,ctrl-e'
	)

	IFS=$'\n' out=("$(fzf ${fzf_opts[@]})")

	key=$(head -1 <<<"${out[@]}")
	file=$(head -2 <<<"${out[@]}" | tail -1)

	if [[ -n "$file" ]]; then
		if [[ "${key}" = ctrl-o ]]; then
			nvr -s -- "${file}"
		else
			"${EDITOR:-nvim}" -- "${file}"
		fi
	fi
}

fe "$@"
