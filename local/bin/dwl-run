#!/usr/bin/env bash
#
# Launch dwl
# USAGE: dwl-run [-log]

# [ Wayland env variables ]
# Session
export XDG_SESSION_TYPE=wayland
export XDG_CURRENT_DESKTOP=dwl

# Firefox
export MOZ_ENABLE_WAYLAND=1

# Force GTK to use wayland
export CLUTTER_BACKEND=wayland

# Qt 5
export QT_QPA_PLATFORM=wayland-egl

# Java
export _JAVA_AWT_WM_NONREPARENTING=1


dwl-run() {
  local log_date log_dir

  log_date=$(date +"%Y_%m_%d-%H_%M_%S")
  log_dir="$HOME"/.cache/log

  if [[ $# -eq 0 ]]; then
    exec dbus-run-session dwl -s dwl-autostart \
      1> "$HOME"/.cache/log/dwltags.log \
      2> /dev/null
  else
    case "$1" in
      -log)
        exec dbus-run-session dwl -s dwl-autostart \
          1> "${log_dir}"/dwltags.log \
          2> "${log_dir}"/dwl-"${log_date}".log
      ;;
      *) exit 1 ;;
    esac
  fi
}

dwl-run "$@"

