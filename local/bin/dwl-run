#!/usr/bin/env bash
#
# Launch dwl
#
# USAGE: dwl-run
# REQUIREMENTS: dwl dbus

# [ Wayland env variables ]
# Session
export XDG_SESSION_TYPE=wayland
export XDG_CURRENT_DESKTOP=dwl

# Firefox
export MOZ_ENABLE_WAYLAND=1

# Force GTK to use wayland
export CLUTTER_BACKEND=wayland

# Qt 5
export QT_QPA_PLATFORM=wayland-egl

# Java
export _JAVA_AWT_WM_NONREPARENTING=1

dwl-run()
{
	local log_date log_file

	log_date=$(date +"%Y_%m_%dT%H_%M_%S")
	log_file=$(mktemp -t dwl-"${log_date}".XXXXXXXXXX.log)
	tags_file=/tmp/"$USER"/dwl-tags.log

	exec dbus-run-session dwl -s dwl-autostart \
		1>"${tags_file}" 2>"${log_file}"
}

dwl-run "$@"
