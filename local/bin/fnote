#!/usr/bin/env bash
#
# Search for header in markdown files
#
# USAGE: fnote
# REQUIREMENTS: ripgrep fzf nvim

fnote()
{
	local file line notes_dir
	local -a rg_opts

	notes_dir="$HOME"/media/notes
	rg_opts=(--color=always --no-heading --line-number --smart-case --only-matching)

	read -r file line <<<"$(rg "${rg_opts[@]}" -- '^\#+\s.*$' "${notes_dir}" 2>/dev/null |
		fzf -0 -1 --query="$1" |
		awk -F: '{print $1, $2}')"

	[[ -n "${file}" ]] && "${EDITOR:-nvim}" "${file}" +"${line}"
}

fnote "$@"
