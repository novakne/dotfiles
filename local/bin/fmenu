#!/usr/bin/env bash

set -x

IFS=':'

_get_selection() {
    if which fzf >/dev/null 2>&1; then
        { IFS=':'; ls -H "$PATH"; } | sort | fzf
    else
        exit 1
    fi
}

_menu() {
  if selection=$( _get_selection ); then
    setsid "$selection" 2>/dev/null 1>/dev/null &

    if [ -n "$1" ]; then
      sleep "$1"
    else
      sleep 1
    fi
  fi
}

main() {
  local -a foot_opts

  foot_opts=(
    --app-id 'fmenu'
    --window-size-pixels 800x200
  )

  riverctl float-filter-add "fmenu"
  # foot "${foot_opts[@]}" bash -c _menu "$@"
  if selection=$( _get_selection ); then
    setsid "$selection" 2>/dev/null 1>/dev/null &

    if [ -n "$1" ]; then
      sleep "$1"
    else
      sleep 1
    fi
  fi
}

main "$@"

