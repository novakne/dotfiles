#!/usr/bin/env bash
#
# Launch River
#
# USAGE: river-run [-log]
# REQUIREMENTS: river dbus

# [  Wayland env variables ]
#Session
export XDG_SESSION_TYPE=wayland
export XDG_CURRENT_DESKTOP=river

# Firefox
export MOZ_ENABLE_WAYLAND=1

# Force GTK to use wayland
export CLUTTER_BACKEND=wayland

# Qt 5
export QT_QPA_PLATFORM=wayland-egl

# Java
export _JAVA_AWT_WM_NONREPARENTING=1


river-run() {
  local log_date log_file

  log_date=$(date +"%Y_%m_%dT%H_%M_%S")
  log_file=$(mktemp -t river-"${log_date}".XXXXXXXXXX.log) 

  if [[ $# -eq 0 ]]; then
    exec dbus-run-session river >/dev/null 2>&1
  else
    case "$1" in
      -log) exec dbus-run-session river -l 7 > "${log_file}" 2>&1 ;;
      *) exec dbus-run-session river >/dev/null 2>&1 ;;
    esac
  fi
}

river-run "$@"

